{% extends "base.html" %}

{% block title %}试听课管理 - 客户管理系统{% endblock %}
{% block page_title %}试听课管理{% endblock %}

{% block content %}
<div class="page-container">
    <!-- 统计卡片 -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-play-circle"></i>
            </div>
            <div class="stat-content">
                <h3>{{ stats.total_trials }}</h3>
                <p>试听课总数</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-content">
                <h3>¥{{ "%.2f"|format(stats.total_revenue) }}</h3>
                <p>总收入</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-coins"></i>
            </div>
            <div class="stat-content">
                <h3>¥{{ "%.2f"|format(stats.total_cost) }}</h3>
                <p>总成本</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-content">
                <h3>¥{{ "%.2f"|format(stats.total_profit) }}</h3>
                <p>总利润</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-percentage"></i>
            </div>
            <div class="stat-content">
                <h3>¥{{ "%.2f"|format(stats.total_fees) }}</h3>
                <p>总手续费</p>
            </div>
        </div>
    </div>

    <!-- 添加试听课按钮 -->
    <div class="form-section">
        <div class="add-trial-header">
            <h3><i class="fas fa-plus"></i> 试听课管理</h3>
            <button type="button" class="btn btn-primary" id="addTrialBtn">
                <i class="fas fa-user-plus"></i> 录入新学员
            </button>
        </div>
    </div>

    <!-- 录入新学员模态框 -->
    <div id="addTrialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4><i class="fas fa-user-plus"></i> 录入新学员试听课</h4>
                <span class="close">&times;</span>
            </div>
            <form method="POST" class="modal-form" id="trialForm">
                <div class="modal-body">
                    <!-- 智能识别区域 -->
                    <div class="form-section-modal">
                        <h5><i class="fas fa-magic"></i> 智能识别 <small style="color: #6c757d;">(可选)</small></h5>
                        <div class="smart-input-container">
                            <textarea id="smartInput" placeholder="粘贴学员信息，系统将自动识别并填入表单...&#10;&#10;示例格式：&#10;学员姓名：张淼&#10;性别：女&#10;年级：新高一&#10;地区：天津&#10;英语试卷满分：120&#10;英语当前分数：100&#10;联系方式：13820863683&#10;是否参加过英语课外辅导：否" rows="6"></textarea>
                            <button type="button" id="parseBtn" class="btn btn-info">
                                <i class="fas fa-wand-magic-sparkles"></i> 智能解析
                            </button>
                        </div>
                    </div>
                    
                    <!-- 学员信息 -->
                    <div class="form-section-modal">
                        <h5><i class="fas fa-user"></i> 学员信息</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new_customer_name">学员姓名 *</label>
                                <input type="text" name="new_customer_name" id="new_customer_name" placeholder="请输入学员姓名" required>
                            </div>
                            <div class="form-group">
                                <label for="new_customer_phone">联系电话 *</label>
                                <input type="tel" name="new_customer_phone" id="new_customer_phone" placeholder="请输入联系电话" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new_customer_gender">性别</label>
                                <select name="new_customer_gender" id="new_customer_gender">
                                    <option value="">请选择</option>
                                    <option value="男">男</option>
                                    <option value="女">女</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="new_customer_grade">年级</label>
                                <select name="new_customer_grade" id="new_customer_grade">
                                    <option value="">请选择</option>
                                    <option value="一年级">一年级</option>
                                    <option value="二年级">二年级</option>
                                    <option value="三年级">三年级</option>
                                    <option value="四年级">四年级</option>
                                    <option value="五年级">五年级</option>
                                    <option value="六年级">六年级</option>
                                    <option value="初一">初一</option>
                                    <option value="初二">初二</option>
                                    <option value="初三">初三</option>
                                    <option value="高一">高一</option>
                                    <option value="高二">高二</option>
                                    <option value="高三">高三</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="new_customer_region">地区</label>
                                <input type="text" name="new_customer_region" id="new_customer_region" placeholder="请输入地区">
                            </div>
                        </div>
                        
                        <!-- 英语成绩信息 -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="english_full_score">英语试卷满分</label>
                                <input type="number" name="english_full_score" id="english_full_score" placeholder="如：120" min="0">
                            </div>
                            <div class="form-group">
                                <label for="english_current_score">英语当前分数</label>
                                <input type="number" name="english_current_score" id="english_current_score" placeholder="如：100" min="0">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="has_tutoring_experience">是否参加过英语课外辅导</label>
                                <select name="has_tutoring_experience" id="has_tutoring_experience">
                                    <option value="">请选择</option>
                                    <option value="是">是</option>
                                    <option value="否">否</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 试听课信息 -->
                    <div class="form-section-modal">
                        <h5><i class="fas fa-book"></i> 试听课信息</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="trial_price">试听课售价 *</label>
                                <input type="number" name="trial_price" id="trial_price" step="0.01" min="0" placeholder="请输入售价" required>
                            </div>
                            <div class="form-group">
                                <label for="source">渠道来源 *</label>
                                <select name="source" id="source" required>
                                    <option value="">请选择渠道</option>
                                    <option value="淘宝">淘宝</option>
                                    <option value="视频号">视频号</option>
                                    <option value="抖音">抖音</option>
                                    <option value="小红书">小红书</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelBtn">取消</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> 保存试听课记录
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 编辑试听课模态框 -->
    <div id="editTrialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4><i class="fas fa-edit"></i> 编辑试听课信息</h4>
                <span class="close-edit">&times;</span>
            </div>
            <form method="POST" class="modal-form" id="editTrialForm">
                <input type="hidden" id="edit_course_id" name="course_id">
                <div class="modal-body">
                    <!-- 学员信息 -->
                    <div class="form-section-modal">
                        <h5><i class="fas fa-user"></i> 学员信息</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit_customer_name">学员姓名 *</label>
                                <input type="text" name="customer_name" id="edit_customer_name" placeholder="请输入学员姓名" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_customer_phone">联系电话 *</label>
                                <input type="tel" name="customer_phone" id="edit_customer_phone" placeholder="请输入联系电话" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit_customer_gender">性别</label>
                                <select name="customer_gender" id="edit_customer_gender">
                                    <option value="">请选择</option>
                                    <option value="男">男</option>
                                    <option value="女">女</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit_customer_grade">年级</label>
                                <select name="customer_grade" id="edit_customer_grade">
                                    <option value="">请选择</option>
                                    <option value="一年级">一年级</option>
                                    <option value="二年级">二年级</option>
                                    <option value="三年级">三年级</option>
                                    <option value="四年级">四年级</option>
                                    <option value="五年级">五年级</option>
                                    <option value="六年级">六年级</option>
                                    <option value="初一">初一</option>
                                    <option value="初二">初二</option>
                                    <option value="初三">初三</option>
                                    <option value="高一">高一</option>
                                    <option value="高二">高二</option>
                                    <option value="高三">高三</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit_customer_region">地区</label>
                                <input type="text" name="customer_region" id="edit_customer_region" placeholder="请输入地区">
                            </div>
                            <div class="form-group">
                                <label for="edit_has_tutoring_experience">是否参加过英语课外辅导</label>
                                <select name="has_tutoring_experience" id="edit_has_tutoring_experience">
                                    <option value="">请选择</option>
                                    <option value="是">是</option>
                                    <option value="否">否</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 试听课信息 -->
                    <div class="form-section-modal">
                        <h5><i class="fas fa-book"></i> 试听课信息</h5>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="edit_trial_price">试听课售价 *</label>
                                <input type="number" name="trial_price" id="edit_trial_price" step="0.01" min="0" placeholder="请输入售价" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_source">渠道来源 *</label>
                                <select name="source" id="edit_source" required>
                                    <option value="">请选择渠道</option>
                                    <option value="淘宝">淘宝</option>
                                    <option value="视频号">视频号</option>
                                    <option value="抖音">抖音</option>
                                    <option value="小红书">小红书</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="editCancelBtn">取消</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> 保存修改
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 数据统计图表 -->
    <div class="charts-section">
        <div class="charts-grid">
            <div class="chart-card">
                <h4><i class="fas fa-chart-pie"></i> 渠道来源分布</h4>
                <canvas id="sourceChart" width="300" height="200"></canvas>
            </div>
            <div class="chart-card">
                <h4><i class="fas fa-chart-bar"></i> 转化率统计</h4>
                <canvas id="conversionChart" width="300" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- 试听课列表 -->
    <div class="table-section">
        <div class="table-header">
            <h3><i class="fas fa-list"></i> 试听课记录</h3>
            
            <!-- 搜索和筛选 -->
            <div class="search-filter-section">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="搜索学员姓名或电话..." class="search-input">
                    <i class="fas fa-search search-icon"></i>
                </div>
                
                <div class="filter-controls">
                    <select id="sourceFilter" class="filter-select">
                        <option value="">全部渠道</option>
                        <option value="淘宝">淘宝</option>
                        <option value="视频号">视频号</option>
                        <option value="抖音">抖音</option>
                        <option value="小红书">小红书</option>
                        <option value="其他">其他</option>
                    </select>
                    
                    <select id="statusFilter" class="filter-select">
                        <option value="">全部状态</option>
                        <option value="pending">待转化</option>
                        <option value="converted">已转正课</option>
                    </select>
                    
                    <button id="exportBtn" class="btn btn-outline-primary">
                        <i class="fas fa-download"></i> 导出数据
                    </button>
                </div>
            </div>
        </div>
        
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>学员姓名</th>
                        <th>性别</th>
                        <th>年级</th>
                        <th>地区</th>
                        <th>联系方式</th>
                        <th>体验情况</th>
                        <th>试听课售价</th>
                        <th>渠道来源</th>
                        <th>手续费</th>
                        <th>报名时间</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course, customer in trial_courses %}
                    <tr>
                        <td>{{ customer.name }}</td>
                        <td>{{ customer.gender or '-' }}</td>
                        <td>{{ customer.grade or '-' }}</td>
                        <td>{{ customer.region or '-' }}</td>
                        <td>{{ customer.phone }}</td>
                        <td>
                            {% if customer.has_tutoring_experience == '是' %}
                                <span class="status-badge status-experience">有体验</span>
                            {% elif customer.has_tutoring_experience == '否' %}
                                <span class="status-badge status-no-experience">无体验</span>
                            {% else %}
                                <span class="text-muted">未知</span>
                            {% endif %}
                        </td>
                        <td>¥{{ "%.2f"|format(course.trial_price) }}</td>
                        <td>{{ course.source or '-' }}</td>
                        <td>
                            {% if course.source == '淘宝' %}
                                {% set fee_amount = course.trial_price * (taobao_fee_rate or 0.006) %}
                                ¥{{ "%.2f"|format(fee_amount) }}
                            {% else %}
                                ¥0.00
                            {% endif %}
                        </td>
                        <td>{{ course.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            {% if course.converted_to_course %}
                                <span class="status-badge status-converted">已转正课</span>
                            {% else %}
                                <span class="status-badge status-pending">待转化</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button onclick="editTrialCourse({{ course.id }}, '{{ customer.name }}', '{{ customer.phone }}', '{{ customer.gender or '' }}', '{{ customer.grade or '' }}', '{{ customer.region or '' }}', {{ course.trial_price }}, '{{ course.source or '' }}', '{{ customer.has_tutoring_experience or '' }}')" 
                                        class="btn btn-sm btn-primary" title="编辑详情">
                                    <i class="fas fa-edit"></i>
                                </button>
                                {% if not course.converted_to_course %}
                                <a href="{{ url_for('convert_trial_to_course', trial_id=course.id) }}" 
                                   class="btn btn-sm btn-success" title="转正课">
                                    <i class="fas fa-arrow-right"></i>
                                </a>
                                {% if customer.has_tutoring_experience == '是' %}
                                <button onclick="deleteTrialCourse({{ course.id }}, '体验课用户')" 
                                        class="btn btn-sm btn-warning" title="删除体验课用户">
                                    <i class="fas fa-user-times"></i>
                                </button>
                                {% elif customer.has_tutoring_experience == '否' %}
                                <button onclick="deleteTrialCourse({{ course.id }}, '试听课用户')" 
                                        class="btn btn-sm btn-danger" title="删除试听课用户">
                                    <i class="fas fa-trash"></i>
                                </button>
                                {% else %}
                                <button onclick="deleteTrialCourse({{ course.id }}, '试听课用户')" 
                                        class="btn btn-sm btn-danger" title="删除">
                                    <i class="fas fa-trash"></i>
                                </button>
                                {% endif %}
                                {% else %}
                                <span class="text-muted">已转化</span>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="11" class="text-center">暂无试听课记录</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 消息提示 -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div id="flash-messages">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<script>
// 删除试听课记录
function deleteTrialCourse(courseId, userType = '试听课用户') {
    const confirmMessage = userType === '体验课用户' ? 
        '确定要删除这条体验课用户记录吗？' : 
        '确定要删除这条试听课记录吗？';
    
    if (confirm(confirmMessage)) {
        fetch(`/api/trial-courses/${courseId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || '删除失败');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('删除失败');
        });
    }
}

// 编辑试听课记录
function editTrialCourse(courseId, name, phone, gender, grade, region, price, source, hasTutoringExperience) {
    // 填充表单数据
    document.getElementById('edit_course_id').value = courseId;
    document.getElementById('edit_customer_name').value = name;
    document.getElementById('edit_customer_phone').value = phone;
    document.getElementById('edit_customer_gender').value = gender;
    document.getElementById('edit_customer_grade').value = grade;
    document.getElementById('edit_customer_region').value = region;
    document.getElementById('edit_trial_price').value = price;
    document.getElementById('edit_source').value = source;
    document.getElementById('edit_has_tutoring_experience').value = hasTutoringExperience;
    
    // 显示编辑模态框
    document.getElementById('editTrialModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

// 页面加载完成后执行
document.addEventListener('DOMContentLoaded', function() {
    console.log('试听课管理页面加载完成');
    
    // 模态框控制
     const addTrialBtn = document.getElementById('addTrialBtn');
     const trialModal = document.getElementById('addTrialModal');
     const closeModal = document.querySelector('.close');
     const cancelBtn = document.getElementById('cancelBtn');
     const trialForm = document.getElementById('trialForm');
     
     // 打开模态框
     if (addTrialBtn) {
         addTrialBtn.addEventListener('click', function() {
             trialModal.style.display = 'block';
             document.body.style.overflow = 'hidden'; // 防止背景滚动
         });
     }
     
     // 关闭模态框
     function closeTrialModal() {
         trialModal.style.display = 'none';
         document.body.style.overflow = 'auto';
         trialForm.reset(); // 重置表单
     }
     
     if (closeModal) closeModal.addEventListener('click', closeTrialModal);
     if (cancelBtn) cancelBtn.addEventListener('click', closeTrialModal);
     
     // 点击模态框外部关闭
     window.addEventListener('click', function(event) {
         if (event.target === trialModal) {
             closeTrialModal();
         }
     });
     
     // 编辑模态框控制
     const editTrialModal = document.getElementById('editTrialModal');
     const editCloseModal = editTrialModal.querySelector('.close');
     const editCancelBtn = document.getElementById('editCancelBtn');
     const editTrialForm = document.getElementById('editTrialForm');
     
     // 关闭编辑模态框
     function closeEditTrialModal() {
         editTrialModal.style.display = 'none';
         document.body.style.overflow = 'auto';
         editTrialForm.reset(); // 重置表单
     }
     
     if (editCloseModal) editCloseModal.addEventListener('click', closeEditTrialModal);
     if (editCancelBtn) editCancelBtn.addEventListener('click', closeEditTrialModal);
     
     // 点击编辑模态框外部关闭
     window.addEventListener('click', function(event) {
         if (event.target === editTrialModal) {
             closeEditTrialModal();
         }
     });
     
     // 编辑表单提交
     if (editTrialForm) {
         editTrialForm.addEventListener('submit', function(e) {
         e.preventDefault();
         
         const courseId = document.getElementById('edit_course_id').value;
         const formData = new FormData(editTrialForm);
         
         fetch(`/api/trial-courses/${courseId}`, {
             method: 'PUT',
             body: formData
         })
         .then(response => response.json())
         .then(data => {
             if (data.success) {
                 alert('试听课信息更新成功！');
                 closeEditTrialModal();
                 location.reload();
             } else {
                 alert(data.message || '更新失败');
             }
         })
         .catch(error => {
             console.error('Error:', error);
             alert('更新失败');
         });
     });
     }
     
     // 智能识别功能
    const smartInput = document.getElementById('smartInput');
    const parseBtn = document.getElementById('parseBtn');
    
    console.log('smartInput:', smartInput);
    console.log('parseBtn:', parseBtn);
    
    if (parseBtn && smartInput) {
        parseBtn.addEventListener('click', function() {
            const text = smartInput.value.trim();
             if (!text) {
                 alert('请先输入学员信息');
                 return;
             }
             
             // 解析文本并填入表单
             parseStudentInfo(text);
             
             // 清空智能识别区域
             smartInput.value = '';
             
             // 显示成功提示
             showParseSuccess();
         });
     }
     
     // 解析学员信息的函数
     function parseStudentInfo(text) {
         // 定义匹配规则
         const patterns = {
             name: [
                 /学员姓名[：:]\s*([^\n\r]+)/i,
                 /姓名[：:]\s*([^\n\r]+)/i,
                 /名字[：:]\s*([^\n\r]+)/i
             ],
             gender: [
                 /性别[：:]\s*([男女])/i
             ],
             grade: [
                 /年级[：:]\s*([^\n\r]+)/i,
                 /学年[：:]\s*([^\n\r]+)/i
             ],
             region: [
                 /地区[：:]\s*([^\n\r]+)/i,
                 /地址[：:]\s*([^\n\r]+)/i,
                 /城市[：:]\s*([^\n\r]+)/i
             ],
             phone: [
                 /联系方式[：:]\s*([1][3-9]\d{9})/i,
                 /电话[：:]\s*([1][3-9]\d{9})/i,
                 /手机[：:]\s*([1][3-9]\d{9})/i,
                 /([1][3-9]\d{9})/g
             ],
             englishFullScore: [
                 /英语试卷满分[：:]\s*(\d+)/i,
                 /满分[：:]\s*(\d+)/i
             ],
             englishCurrentScore: [
                 /英语当前分数[：:]\s*(\d+)/i,
                 /当前分数[：:]\s*(\d+)/i,
                 /现在分数[：:]\s*(\d+)/i
             ],
             hasTutoring: [
                 /是否参加过英语课外辅导[：:]\s*([是否])/i,
                 /课外辅导[：:]\s*([是否])/i
             ]
         };
         
         // 解析各个字段
         const results = {};
         
         for (const [field, regexList] of Object.entries(patterns)) {
             for (const regex of regexList) {
                 const match = text.match(regex);
                 if (match && match[1]) {
                     results[field] = match[1].trim();
                     break;
                 }
             }
         }
         
         // 填入表单
         if (results.name) {
             document.getElementById('new_customer_name').value = results.name;
         }
         
         if (results.gender) {
             document.getElementById('new_customer_gender').value = results.gender;
         }
         
         if (results.grade) {
             // 处理年级格式
             let grade = results.grade;
             if (grade.includes('新')) {
                 grade = grade.replace('新', '');
             }
             // 尝试匹配下拉选项
             const gradeSelect = document.getElementById('new_customer_grade');
             const options = Array.from(gradeSelect.options);
             const matchedOption = options.find(option => 
                 option.value.includes(grade) || grade.includes(option.value)
             );
             if (matchedOption) {
                 gradeSelect.value = matchedOption.value;
             }
         }
         
         if (results.region) {
             document.getElementById('new_customer_region').value = results.region;
         }
         
         if (results.phone) {
             document.getElementById('new_customer_phone').value = results.phone;
         }
         
         if (results.englishFullScore) {
             document.getElementById('english_full_score').value = results.englishFullScore;
         }
         
         if (results.englishCurrentScore) {
             document.getElementById('english_current_score').value = results.englishCurrentScore;
         }
         
         if (results.hasTutoring) {
             document.getElementById('has_tutoring_experience').value = results.hasTutoring;
         }
         
         console.log('解析结果:', results);
     }
     
     // 显示解析成功提示
     function showParseSuccess() {
         const btn = document.getElementById('parseBtn');
         if (btn) {
             const originalText = btn.innerHTML;
             btn.innerHTML = '<i class="fas fa-check"></i> 解析成功！';
             btn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
             
             setTimeout(() => {
                 btn.innerHTML = originalText;
                 btn.style.background = 'linear-gradient(135deg, #17a2b8 0%, #138496 100%)';
             }, 2000);
         }
     }
     
     // 表单提交验证
     if (trialForm) {
         trialForm.addEventListener('submit', function(e) {
             const name = document.getElementById('new_customer_name').value.trim();
             const phone = document.getElementById('new_customer_phone').value.trim();
             const price = document.getElementById('trial_price').value.trim();
             const source = document.getElementById('source').value;
            
            if (!name) {
                e.preventDefault();
                alert('请输入学员姓名');
                return;
            }
            
            if (!phone) {
                e.preventDefault();
                alert('请输入联系电话');
                return;
            }
            
            // 验证手机号格式
            const phoneRegex = /^1[3-9]\d{9}$/;
            if (!phoneRegex.test(phone)) {
                e.preventDefault();
                alert('请输入正确的手机号码');
                return;
            }
            
            if (!price || parseFloat(price) < 0) {
                e.preventDefault();
                alert('请输入正确的试听课售价');
                return;
            }
            
            if (!source) {
                e.preventDefault();
                alert('请选择渠道来源');
                return;
            }
         });
    }
    
    // 自动隐藏消息提示
    const flashMessages = document.getElementById('flash-messages');
    if (flashMessages) {
        setTimeout(() => {
            flashMessages.style.opacity = '0';
            setTimeout(() => {
                flashMessages.remove();
            }, 300);
        }, 3000);
    }
    
    // 搜索和筛选功能
    const searchInput = document.getElementById('searchInput');
    const sourceFilter = document.getElementById('sourceFilter');
    const statusFilter = document.getElementById('statusFilter');
    const exportBtn = document.getElementById('exportBtn');
    const tableRows = document.querySelectorAll('.data-table tbody tr');
    
    // 初始化图表
    initCharts();
    
    // 搜索功能
    function filterTable() {
        const searchTerm = searchInput.value.toLowerCase();
        const sourceValue = sourceFilter.value;
        const statusValue = statusFilter.value;
        
        tableRows.forEach(row => {
             if (row.cells.length === 1) return; // 跳过"暂无记录"行
             
             const name = row.cells[0].textContent.toLowerCase(); // 学员姓名
             const phone = row.cells[4].textContent.toLowerCase(); // 联系方式
             const source = row.cells[6].textContent; // 渠道来源
             const statusElement = row.cells[8].querySelector('.status-badge'); // 状态
             const status = statusElement ? (statusElement.classList.contains('status-converted') ? 'converted' : 'pending') : '';
            
            const matchesSearch = name.includes(searchTerm) || phone.includes(searchTerm);
            const matchesSource = !sourceValue || source === sourceValue;
            const matchesStatus = !statusValue || status === statusValue;
            
            if (matchesSearch && matchesSource && matchesStatus) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
        
        // 更新统计信息和图表
        updateFilterStats();
        updateChartsWithFilteredData();
    }
    
    // 更新筛选后的统计信息
    function updateFilterStats() {
        const visibleRows = Array.from(tableRows).filter(row => 
            row.style.display !== 'none' && row.cells.length > 1
        );
        
        let totalPrice = 0;
        visibleRows.forEach(row => {
             const priceText = row.cells[5].textContent.replace('¥', ''); // 试听课售价
             totalPrice += parseFloat(priceText) || 0;
         });
        
        // 可以在这里添加显示筛选后统计信息的逻辑
        console.log(`筛选后记录数: ${visibleRows.length}, 总金额: ¥${totalPrice.toFixed(2)}`);
    }
    
    // 绑定事件
    if (searchInput) searchInput.addEventListener('input', filterTable);
    if (sourceFilter) sourceFilter.addEventListener('change', filterTable);
    if (statusFilter) statusFilter.addEventListener('change', filterTable);
    
    // 导出功能
    if (exportBtn) {
        exportBtn.addEventListener('click', function() {
        const visibleRows = Array.from(tableRows).filter(row => 
            row.style.display !== 'none' && row.cells.length > 1
        );
        
        if (visibleRows.length === 0) {
            alert('没有数据可导出');
            return;
        }
        
        // 构建CSV数据
        let csvContent = '学员姓名,性别,年级,地区,联系方式,试听课售价,渠道来源,报名时间,状态\n';
        
        visibleRows.forEach(row => {
             const cells = Array.from(row.cells).slice(0, 9); // 排除操作列
            const rowData = cells.map(cell => {
                let text = cell.textContent.trim();
                // 处理状态列
                if (cell.querySelector('.status-badge')) {
                    text = cell.querySelector('.status-badge').textContent.trim();
                }
                // 转义CSV特殊字符
                if (text.includes(',') || text.includes('"') || text.includes('\n')) {
                    text = '"' + text.replace(/"/g, '""') + '"';
                }
                return text;
            });
            csvContent += rowData.join(',') + '\n';
        });
        
        // 下载文件
        const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `试听课记录_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
         document.body.removeChild(link);
         });
     }
     

     
     // 根据筛选结果更新图表
      function updateChartsWithFilteredData() {
          const visibleRows = Array.from(tableRows).filter(row => 
              row.style.display !== 'none' && row.cells.length > 1
          );
          
          const sourceData = {};
          const conversionData = { total: 0, converted: 0 };
          
          visibleRows.forEach(row => {
              const source = row.cells[6].textContent.trim();
              const statusElement = row.cells[8].querySelector('.status-badge');
              const isConverted = statusElement && statusElement.classList.contains('status-converted');
              
              // 统计渠道来源
              sourceData[source] = (sourceData[source] || 0) + 1;
              
              // 统计转化率
              conversionData.total++;
              if (isConverted) {
                  conversionData.converted++;
              }
          });
          
          // 重新绘制图表
          drawSourceChart(sourceData);
          drawConversionChart(conversionData);
      }
      
      // 图表初始化函数
      function initCharts() {
         // 统计数据
         const sourceData = {};
         const conversionData = { total: 0, converted: 0 };
         
         tableRows.forEach(row => {
             if (row.cells.length === 1) return; // 跳过"暂无记录"行
             
             const source = row.cells[6].textContent.trim();
             const statusElement = row.cells[8].querySelector('.status-badge');
             const isConverted = statusElement && statusElement.classList.contains('status-converted');
             
             // 统计渠道来源
             sourceData[source] = (sourceData[source] || 0) + 1;
             
             // 统计转化率
             conversionData.total++;
             if (isConverted) {
                 conversionData.converted++;
             }
         });
         
         // 绘制渠道来源饼图
         drawSourceChart(sourceData);
         
         // 绘制转化率柱状图
         drawConversionChart(conversionData);
     }
     
     // 绘制渠道来源饼图
     function drawSourceChart(data) {
         const canvas = document.getElementById('sourceChart');
         const ctx = canvas.getContext('2d');
         const centerX = canvas.width / 2;
         const centerY = canvas.height / 2;
         const radius = Math.min(centerX, centerY) - 20;
         
         // 清空画布
         ctx.clearRect(0, 0, canvas.width, canvas.height);
         
         if (Object.keys(data).length === 0) {
             ctx.fillStyle = '#666';
             ctx.font = '14px Arial';
             ctx.textAlign = 'center';
             ctx.fillText('暂无数据', centerX, centerY);
             return;
         }
         
         const total = Object.values(data).reduce((sum, val) => sum + val, 0);
         const colors = ['#007bff', '#28a745', '#ffc107', '#dc3545', '#6f42c1', '#fd7e14'];
         
         let currentAngle = -Math.PI / 2;
         let colorIndex = 0;
         
         // 绘制饼图
         Object.entries(data).forEach(([source, count]) => {
             const sliceAngle = (count / total) * 2 * Math.PI;
             
             ctx.beginPath();
             ctx.moveTo(centerX, centerY);
             ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
             ctx.closePath();
             ctx.fillStyle = colors[colorIndex % colors.length];
             ctx.fill();
             
             // 绘制标签
             const labelAngle = currentAngle + sliceAngle / 2;
             const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
             const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
             
             ctx.fillStyle = 'white';
             ctx.font = 'bold 12px Arial';
             ctx.textAlign = 'center';
             ctx.fillText(`${count}`, labelX, labelY);
             
             currentAngle += sliceAngle;
             colorIndex++;
         });
         
         // 绘制图例
         let legendY = 10;
         colorIndex = 0;
         Object.entries(data).forEach(([source, count]) => {
             const percentage = ((count / total) * 100).toFixed(1);
             
             ctx.fillStyle = colors[colorIndex % colors.length];
             ctx.fillRect(canvas.width - 120, legendY, 12, 12);
             
             ctx.fillStyle = '#333';
             ctx.font = '11px Arial';
             ctx.textAlign = 'left';
             ctx.fillText(`${source} (${percentage}%)`, canvas.width - 105, legendY + 9);
             
             legendY += 18;
             colorIndex++;
         });
     }
     
     // 绘制转化率柱状图
     function drawConversionChart(data) {
         const canvas = document.getElementById('conversionChart');
         const ctx = canvas.getContext('2d');
         
         // 清空画布
         ctx.clearRect(0, 0, canvas.width, canvas.height);
         
         if (data.total === 0) {
             ctx.fillStyle = '#666';
             ctx.font = '14px Arial';
             ctx.textAlign = 'center';
             ctx.fillText('暂无数据', canvas.width / 2, canvas.height / 2);
             return;
         }
         
         const conversionRate = (data.converted / data.total * 100).toFixed(1);
         const pendingRate = (100 - conversionRate).toFixed(1);
         
         const barWidth = 80;
         const maxHeight = canvas.height - 60;
         const spacing = 60;
         
         // 绘制已转化柱状图
         const convertedHeight = (data.converted / data.total) * maxHeight;
         ctx.fillStyle = '#28a745';
         ctx.fillRect(spacing, canvas.height - 40 - convertedHeight, barWidth, convertedHeight);
         
         // 绘制待转化柱状图
         const pendingCount = data.total - data.converted;
         const pendingHeight = (pendingCount / data.total) * maxHeight;
         ctx.fillStyle = '#ffc107';
         ctx.fillRect(spacing + barWidth + 40, canvas.height - 40 - pendingHeight, barWidth, pendingHeight);
         
         // 绘制标签
         ctx.fillStyle = '#333';
         ctx.font = '12px Arial';
         ctx.textAlign = 'center';
         
         // 已转化标签
         ctx.fillText('已转化', spacing + barWidth / 2, canvas.height - 20);
         ctx.fillText(`${data.converted}`, spacing + barWidth / 2, canvas.height - 45 - convertedHeight);
         ctx.fillText(`${conversionRate}%`, spacing + barWidth / 2, canvas.height - 5);
         
         // 待转化标签
         ctx.fillText('待转化', spacing + barWidth + 40 + barWidth / 2, canvas.height - 20);
         ctx.fillText(`${pendingCount}`, spacing + barWidth + 40 + barWidth / 2, canvas.height - 45 - pendingHeight);
         ctx.fillText(`${pendingRate}%`, spacing + barWidth + 40 + barWidth / 2, canvas.height - 5);
         
         // 绘制标题
         ctx.font = 'bold 14px Arial';
         ctx.fillText(`总转化率: ${conversionRate}%`, canvas.width / 2, 20);
     }
});
</script>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 15px;
}

.stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: white;
}

.stat-card:nth-child(1) .stat-icon { background: #007bff; }
.stat-card:nth-child(2) .stat-icon { background: #28a745; }
.stat-card:nth-child(3) .stat-icon { background: #ffc107; }
.stat-card:nth-child(4) .stat-icon { background: #17a2b8; }

.stat-content h3 {
    margin: 0;
    font-size: 24px;
    font-weight: bold;
    color: #333;
}

.stat-content p {
    margin: 5px 0 0 0;
    color: #666;
    font-size: 14px;
}

.form-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.charts-section {
    margin-bottom: 30px;
}

.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
}

.chart-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    text-align: center;
}

.chart-card h4 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 16px;
    font-weight: 600;
}

.chart-card canvas {
    border: 1px solid #eee;
    border-radius: 4px;
    background: #fafafa;
}

.form-section h3 {
    margin: 0 0 20px 0;
    color: #333;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

.input-mode-selector {
    margin-bottom: 25px;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    border: 1px solid #dee2e6;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.input-mode-selector h4 {
    margin: 0 0 15px 0;
    color: #495057;
    font-size: 16px;
    font-weight: 600;
}

.mode-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.radio-option {
    position: relative;
    cursor: pointer;
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    transition: all 0.3s ease;
    overflow: hidden;
}

.radio-option:hover {
    border-color: #007bff;
    box-shadow: 0 2px 8px rgba(0,123,255,0.15);
    transform: translateY(-1px);
}

.radio-option input[type="radio"] {
    position: absolute;
    top: 12px;
    right: 12px;
    margin: 0;
    accent-color: #007bff;
    transform: scale(1.2);
}

.radio-option input[type="radio"]:checked + .option-content {
    color: #007bff;
}

.radio-option input[type="radio"]:checked {
    background: #007bff;
}

.radio-option:has(input[type="radio"]:checked) {
    border-color: #007bff;
    background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
    box-shadow: 0 2px 8px rgba(0,123,255,0.2);
}

.option-content {
    display: flex;
    flex-direction: column;
    gap: 5px;
    padding-right: 30px;
}

.option-content i {
    font-size: 20px;
    color: #6c757d;
    margin-bottom: 5px;
}

.option-content span {
    font-weight: 600;
    font-size: 14px;
    color: #495057;
}

.option-content small {
    color: #6c757d;
    font-size: 12px;
    line-height: 1.3;
}

.radio-option:has(input[type="radio"]:checked) .option-content i {
    color: #007bff;
}

.radio-option:has(input[type="radio"]:checked) .option-content span {
    color: #007bff;
}

/* 选择已有学员样式 */
.customer-select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 14px;
    background: white;
    transition: all 0.3s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 12px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: 40px;
}

.customer-select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
}

.customer-select option {
    padding: 10px;
    font-size: 14px;
}

.form-help {
    display: block;
    margin-top: 8px;
    color: #6c757d;
    font-size: 12px;
}

.form-help i {
    margin-right: 4px;
    color: #007bff;
}

/* 学员信息预览样式 */
.customer-preview {
    margin-top: 20px;
    padding: 16px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 8px;
    animation: fadeIn 0.3s ease;
}

.customer-preview h5 {
    margin: 0 0 12px 0;
    color: #495057;
    font-size: 14px;
    font-weight: 600;
}

.customer-preview h5 i {
    margin-right: 6px;
    color: #007bff;
}

.preview-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.preview-item {
    display: flex;
    align-items: center;
    gap: 8px;
}

.preview-item label {
    font-weight: 500;
    color: #6c757d;
    font-size: 12px;
    min-width: 40px;
    margin: 0;
}

.preview-item span {
    color: #495057;
    font-size: 13px;
    font-weight: 500;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 添加试听课按钮区域样式 */
.add-trial-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    border: 1px solid #dee2e6;
    margin-bottom: 30px;
}

.add-trial-header h3 {
    margin: 0;
    color: #495057;
    font-size: 18px;
    font-weight: 600;
}

.add-trial-header h3 i {
    margin-right: 8px;
    color: #007bff;
}

/* 模态框样式 */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(3px);
    animation: modalFadeIn 0.3s ease;
}

.modal-content {
    background-color: #fff;
    margin: 3% auto;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    border-bottom: 1px solid #e9ecef;
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    color: white;
    border-radius: 12px 12px 0 0;
}

.modal-header h4 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
}

.modal-header h4 i {
    margin-right: 8px;
}

.close {
    color: white;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 5px;
    border-radius: 50%;
}

.close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

.modal-body {
    padding: 25px;
}

.form-section-modal {
    margin-bottom: 25px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #007bff;
}

.form-section-modal h5 {
    margin: 0 0 15px 0;
    color: #495057;
    font-size: 16px;
    font-weight: 600;
}

.form-section-modal h5 i {
    margin-right: 8px;
    color: #007bff;
}

/* 智能识别区域样式 */
.smart-input-container {
    position: relative;
}

.smart-input-container textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 14px;
    font-family: inherit;
    resize: vertical;
    min-height: 120px;
    transition: all 0.3s ease;
    background: #fff;
}

.smart-input-container textarea:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

.smart-input-container textarea::placeholder {
    color: #6c757d;
    line-height: 1.4;
}

#parseBtn {
    margin-top: 10px;
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

#parseBtn:hover {
    background: linear-gradient(135deg, #138496 0%, #117a8b 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
}

#parseBtn:active {
    transform: translateY(0);
}

.btn-info {
    background: #17a2b8;
    color: white;
}

.modal-form .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.modal-form .form-group {
    display: flex;
    flex-direction: column;
}

.modal-form .form-group:last-child {
    grid-column: 1 / -1;
}

.modal-form label {
    margin-bottom: 5px;
    font-weight: 500;
    color: #495057;
    font-size: 14px;
}

.modal-form input,
.modal-form select {
    padding: 10px 12px;
    border: 2px solid #e9ecef;
    border-radius: 6px;
    font-size: 14px;
    transition: all 0.3s ease;
}

.modal-form input:focus,
.modal-form select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding: 20px 25px;
    border-top: 1px solid #e9ecef;
    background: #f8f9fa;
    border-radius: 0 0 12px 12px;
}

.btn-secondary {
    background: #6c757d;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-1px);
}

@keyframes modalFadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* 响应式设计 */
@media (max-width: 768px) {
    .modal-content {
        width: 95%;
        margin: 5% auto;
    }
    
    .modal-form .form-row {
        grid-template-columns: 1fr;
    }
    
    .add-trial-header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
}

.customer-section {
    transition: all 0.3s ease;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 5px;
    font-weight: 500;
    color: #333;
}

.form-group input,
.form-group select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
}

.table-section {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    overflow: hidden;
}

.table-header {
    padding: 20px;
    border-bottom: 1px solid #eee;
}

.table-header h3 {
    margin: 0 0 20px 0;
    color: #333;
}

.search-filter-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
}

.search-box {
    position: relative;
    flex: 1;
    min-width: 250px;
}

.search-input {
    width: 100%;
    padding: 10px 40px 10px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    transition: border-color 0.2s;
}

.search-input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
}

.search-icon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #6c757d;
    pointer-events: none;
}

.filter-controls {
    display: flex;
    gap: 10px;
    align-items: center;
}

.filter-select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
    background: white;
    min-width: 120px;
}

.filter-select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
}

.btn-outline-primary {
    background: transparent;
    color: #007bff;
    border: 1px solid #007bff;
}

.btn-outline-primary:hover {
    background: #007bff;
    color: white;
}

.btn-outline-danger {
    background: transparent;
    color: #dc3545;
    border: 1px solid #dc3545;
}

.btn-outline-danger:hover {
    background: #dc3545;
    color: white;
}

.batch-checkbox,
.row-checkbox {
    cursor: pointer;
    transform: scale(1.2);
}

.data-table th:first-child,
.data-table td:first-child {
    width: 40px;
    text-align: center;
}

.table-container {
    overflow-x: auto;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th,
.data-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.data-table th {
    background: #f8f9fa;
    font-weight: 600;
    color: #333;
}

.data-table tbody tr:hover {
    background: #f8f9fa;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}

.status-converted {
    background: #d4edda;
    color: #155724;
}

.status-pending {
    background: #fff3cd;
    color: #856404;
}

.status-experience {
    background: #d1ecf1;
    color: #0c5460;
}

.status-no-experience {
    background: #f8d7da;
    color: #721c24;
}

.action-buttons {
    display: flex;
    gap: 5px;
}

.btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
    transition: all 0.2s;
}

.btn-primary {
    background: #007bff;
    color: white;
}

.btn-primary:hover {
    background: #0056b3;
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-success:hover {
    background: #1e7e34;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-danger:hover {
    background: #c82333;
}

.btn-warning {
    background: #ffc107;
    color: #212529;
}

.btn-warning:hover {
    background: #e0a800;
}

.btn-sm {
    padding: 4px 8px;
    font-size: 12px;
}

.text-center {
    text-align: center;
}

.text-muted {
    color: #6c757d;
}

#flash-messages {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    transition: opacity 0.3s;
}

.alert {
    padding: 12px 20px;
    border-radius: 4px;
    margin-bottom: 10px;
    font-weight: 500;
}

.alert-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}
</style>
{% endblock %}