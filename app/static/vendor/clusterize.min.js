/*! Clusterize.js - v0.18.0 - 2017-11-04
* http://NeXTs.github.com/Clusterize.js/
* Copyright (c) 2015 Denis Lukov; Licensed GPLv3 */
!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Clusterize=t()}(this,function(){function e(e,t){return t.querySelector(e)}function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(e,t){return window.getComputedStyle?window.getComputedStyle(t)[e]:t.currentStyle[e]}function r(e,t,o,r){return e[o]=t[o]||r,e}var l=function(){for(var e=3,t=document.createElement("b"),o=t.all||[];t.innerHTML="<!--[if gt IE "+ ++e+"]><i><![endif]-->",o[0];);return e>4?e:document.documentMode}(),s=navigator.platform.toLowerCase().indexOf("mac")+1,i={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{scrollingProgress:function(){},clusterWillChange:function(){},clusterChanged:function(){}}},n=function(e){var t=this,o=t.scroll_elem=e.scrollId?document.getElementById(e.scrollId):e.scrollElem,r=t.content_elem=e.contentId?document.getElementById(e.contentId):e.contentElem;if(!o)throw new Error("Error! Could not find scroll element");if(!r)throw new Error("Error! Could not find content element");var n=t.options={};["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"].forEach(function(t){n[t]="undefined"!=typeof e[t]?e[t]:i[t]});var a,c=[];t.generateEmptyRow=function(){var e=t.options.tag||("TR"===r.children[0].tagName?"TR":"LI");if("TR"===e){var o=document.createElement("tr");o.className=t.options.no_data_class,o.style.height=a+"px";for(var l=t.getRowsHeight(c.slice(0,i.rows_in_block)),s=o.cloneNode(),n=0;n<l.length;n++)s.appendChild(document.createElement("td"));return s.innerHTML=t.options.no_data_text,s.outerHTML}return"<"+e+' class="'+t.options.no_data_class+'">'+t.options.no_data_text+"</"+e+">"},t.getRowsHeight=function(e){if(t.options.tag&&"TR"!==t.options.tag)return[0];var o=r.children[0],l=o?o.children:[],s=l[0],i=[];if(!s)return[0];for(var n,a=e.length,c=s.children.length;a--;)if(i[a]=[],n=l[e[a]])for(var h=c;h--;)i[a][h]=n.children[h].offsetHeight;return i};var h,d=0,u=0,p=!1;t.exploreEnvironment=function(i,n){var f=t.options;if(f.content_tag=r.children[0].tagName,f.tag=f.tag||f.content_tag,"TR"===f.content_tag&&"TABLE"!==r.tagName&&(r=r.parentNode),"TBODY"!==r.tagName&&"TABLE"===r.tagName){var _=document.createElement("tbody");_.appendChild(r.children[0]),r.appendChild(_),r=_}if("TR"===f.tag){var g=document.createElement("div");g.className="clusterize-keep-parity",g.style.display="none",r.insertBefore(g,r.children[0].children[0])}t.options.scroll_top=o.scrollTop,o===window?h=function(){return window.pageYOffset!=d}:h=function(){return o.scrollTop!=d},o[s?"onwheel":"onmousewheel"]=function(){p=!0},n(c,i,a)},t.insertToDOM=function(i,l){t.options.cluster_height||t.exploreEnvironment(i,l);var s=t.options,i=i||c,a=l||t.getClusterNum(),d=a*s.rows_in_cluster-s.rows_in_block*Math.round(a),u=i.slice(d,d+s.rows_in_cluster),p=t.checkChanges("data",u),f=t.checkChanges("top",d),_=t.options.callbacks,g=[];if(p||f){if(f){var w=1*s.itemHeight*d;t.calcScrollDir(s.scroll_top,w),s.beforeCluster=w,s.beforeClusterHeight=d*s.itemHeight,r.style.paddingTop=s.beforeClusterHeight+"px"}s.data=u,h=e("tr",r);var v=t.render(u);s.afterCluster=s.beforeCluster+v.length*s.itemHeight;var m=i.length*s.itemHeight-s.afterCluster;r.lastChild.style.paddingBottom=m+"px";var C=v.join("");if(!p&&f&&h&&"TR"===s.tag){for(var T=t.markParityRows(h,v),b=T.length-1;b>=0;b--)n.insertBefore(n.children[v.length],n.children[T[b]]);n.innerHTML=C}else r.innerHTML=s.beforeClusterHeight?t.generateEmptyRow()+C:C;s.bottom_offset=m,g=u,_.clusterWillChange&&_.clusterWillChange(),_.clusterChanged&&_.clusterChanged()}else{if(0===u.length){s.beforeClusterHeight=0,s.afterCluster=0;var x=t.generateEmptyRow();if("TR"===s.tag){var y=r.children[0];(!t.options.show_no_data_row||y&&y.className!==t.options.no_data_class)&&(r.innerHTML=x)}t.options.callbacks.clusterChanged&&t.options.callbacks.clusterChanged()}g=c}p||f||(_=t.options.callbacks).scrollingProgress&&_.scrollingProgress(t.getScrollProgress()),s.scroll_top=o.scrollTop,"TR"===s.tag&&t.fixElementReferences(r,g,u),l||(o.scrollTop=s.scroll_top)},t.render=function(e){for(var o=t.options,r=o.tag||("TR"===o.content_tag?"TR":"LI"),l='<"'+r+'">',s="</"+r+">",i=[],n=0,a=e.length;n<a;n++)i.push(l+e[n]+s);return i},t.markParityRows=function(e,t){for(var o=e.children,r=o.length,l=t.length,s=[],i=0;i<r;i++){var n=o[i].className.indexOf("odd")>-1;t[i].indexOf("odd")>-1?n||s.push(i):n&&s.push(i)}return s},t.calcScrollDir=function(e,o){t.options.scroll_dir=e-o>0?"up":"down"},t.fixElementReferences=function(e,o,r){for(var l=e.children[0],s=o.indexOf(r[0]),i=0,n=r.length;i<n;i++)if(l=e.children[i])for(var a in r[i]=o[s+i])a&&(l[a]=r[i][a])},t.getClusterNum=function(){var e=t.options;return e.scroll_top=o.scrollTop,Math.floor(e.scroll_top/(e.cluster_height-e.rows_in_block*e.itemHeight))+(e.beforeCluster||0)},t.checkChanges=function(e,o){var r=t.options,l=r.cluster_height;return!(!r[e+"_last_val"]||JSON.stringify(r[e+"_last_val"])!==JSON.stringify(o))&&(r[e+"_last_val"]=o,!0)},t.getScrollProgress=function(){var e=t.options;return e.scroll_top/(e.total_rows_height-o.offsetHeight)*100||0},t.getData=function(){return t.options.data},t.update=function(e){var i=t,l=i.options;return c=l.rows=e||c,a=o.offsetHeight,u>1&&t.calcClusterHeight(c,l.cluster_height),i.insertToDOM(c),o.scrollTop=l.scroll_top,i},t.clear=function(){t.update([])},t.destroy=function(e){var i=t.options,l=t.options.callbacks||{},s={"clusterWillChange":function(){},"clusterChanged":function(){},"scrollingProgress":function(){}};for(var n in s)l[n]=s[n];r.innerHTML="",i.contentHeight=0,u=d=i.scrollTop=o.scrollTop=0,c=i.rows=[],e||o[s?"onwheel":"onmousewheel"]=function(){p=!1}},t.refresh=function(e){t.getRowsHeight(c)&&t.update(c)},t.getRowsAmount=function(){return c.length},t.getScrollProgress=function(){return this.options.scroll_top/(c.length*a)*100||0};var f=0,_=0,g=0;return t.scrollTo=function(e){if(c.length){var r=(t.options.rows_in_cluster-t.options.rows_in_block)*e/c.length,l=e*t.options.itemHeight-r*t.options.itemHeight;o.scrollTop=l}},function(e){var t=o.scrollTop;d!==t&&(h()&&(p||e)&&(d=t,u||(u=1),clearTimeout(f),f=setTimeout(n.refresh,100),n.insertToDOM()),0==t?(_=0,g=0):t+o.offsetHeight>=r.offsetHeight&&c.length&&(n.scrollTo(c.length),_=0,g=0))}(),o.addEventListener("scroll",function(e){0==o.scrollTop&&(_++,_>5&&g!=o.scrollTop)?(n.update(c),g=o.scrollTop):t()}),function(){var e=i.blocks_in_cluster,o=i.rows_in_block,l=function(){u++,a=r.children[1].offsetHeight,t.options.itemHeight=a,t.options.cluster_height=e*o*a};l(),l(),n.insertToDOM(c)}(),n};return n});